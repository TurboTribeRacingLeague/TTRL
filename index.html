<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Turbo Tribe Racing League - Elite F1 25 Sim Racing Competition">
    <title>TTRL | Racing League</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>
        :root {
            --bg-main: #050505;
            --accent-red: #ff1f4b;
            --accent-cyan: #00f0ff;
            --text-primary: #ffffff;
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-bg: rgba(20, 20, 20, 0.95);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            background-color: var(--bg-main);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            overflow: hidden;
            overscroll-behavior: none;
        }

        /* --- CUSTOM CURSOR --- */
        #cursor-follower { display: none; }

        #cursor, #cursor-follower {
            position: fixed; top: 0; left: 0; 
            pointer-events: none !important;
            z-index: 99999;
            transform: translate(-50%, -50%);
            will-change: transform, left, top;
        }
        #cursor {
            width: 12px; height: 12px; 
            background: var(--accent-cyan);
            transform: translate(-50%, -50%) rotate(45deg); 
            transition: width 0.2s, height 0.2s, background 0.2s;
            box-shadow: 0 0 15px var(--accent-cyan);
            mix-blend-mode: difference;
        }
        
        body.hovering #cursor { 
            transform: translate(-50%, -50%) rotate(45deg) scale(1.5);
            background: var(--accent-red);
            box-shadow: 0 0 20px var(--accent-red);
        }

        @media (max-width: 768px) {
            * { cursor: auto !important; }
            #cursor, #cursor-follower { display: none !important; }
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; inset: 0; z-index: 10000; background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-bar { width: 200px; height: 2px; background: #333; margin-top: 20px; position: relative; overflow: hidden; }
        .loader-progress {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan);
        }

        /* --- UI COMPONENTS --- */
        .fixed-ui {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 100;
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            pointer-events: none;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 100%);
        }
        
        .logo { height: 3.5rem; width: auto; pointer-events: auto; cursor: pointer; transition: transform 0.3s ease; }
        .logo:hover { transform: scale(1.05); }
        .header-right { display: flex; align-items: center; gap: 1.5rem; }
        
        .top-nav {
            display: flex; gap: 1rem; pointer-events: auto;
            font-family: 'Rajdhani', sans-serif; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.9rem;
        }
        .top-nav a {
            color: rgba(255, 255, 255, 0.6); text-decoration: none; position: relative;
            padding: 0.5rem 0.5rem; transition: color 0.3s ease; cursor: pointer;
        }
        .top-nav a:hover { color: var(--accent-cyan); }
        .top-nav a::after {
            content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 0; height: 2px; background: var(--accent-red); transition: width 0.3s ease;
        }
        .top-nav a.active { color: var(--text-primary); }
        .top-nav a.active::after { width: 100%; background: var(--accent-cyan); }
        
        /* --- SLIDES --- */
        .slides-wrapper { position: fixed; inset: 0; width: 100%; height: 100%; }
        .slide {
            position: absolute; inset: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            visibility: hidden; opacity: 0;
            will-change: opacity, transform;
        }
        .slide.active { visibility: visible; z-index: 10; opacity: 1; }

        .slide-bg {
            position: absolute; inset: 0; z-index: 1;
            background-size: cover; background-position: center;
            filter: brightness(0.3) grayscale(0.2);
            transform: scale(1.1); will-change: transform;
        }
        #vanta-bg { 
            filter: brightness(1) grayscale(0); 
            background: radial-gradient(circle at center, #111 0%, #050505 100%); 
        }
        #vanta-bg canvas { width: 100% !important; height: 100% !important; }

        /* --- SLIDE CONTENT --- */
        .slide-content {
            position: relative; z-index: 3; 
            width: 100%; 
            padding: 0 1vw; 
            max-width: 100%; 
            display: flex; flex-direction: column; justify-content: center; height: 100%;
        }
        
        #home .slide-content, #register .slide-content, #paddock .slide-content {
            max-width: 1400px; margin: 0 auto; padding: 0 4vw;
        }

        #standings .slide-content, #archives .slide-content, #calendar .slide-content { 
            justify-content: flex-start; 
            padding-top: 8vh; 
            max-width: 98vw;
            margin: 0 auto;
        }

        /* --- TYPOGRAPHY --- */
        .tech-font { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; line-height: 0.9; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        
        .slide-tag {
            display: inline-block; padding: 0.3rem 0.8rem; margin-bottom: 1rem;
            border-left: 2px solid var(--accent-cyan); color: var(--accent-cyan);
            font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.2em;
            background: linear-gradient(90deg, rgba(0, 240, 255, 0.1), transparent);
        }
        
        .slide-title {
            font-size: clamp(2rem, 5vw, 4rem); font-weight: 800; margin-bottom: 0.5rem;
            color: #fff; position: relative; z-index: 2; mix-blend-mode: hard-light;
        }
        .text-outline { -webkit-text-stroke: 1px rgba(255,255,255,0.85); color: transparent; }

        /* --- HOME SECTION --- */
        .home-design-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; width: 100%; position: relative; z-index: 5; padding-top: 4rem; 
        }
        .home-title-group { text-align: center; margin-bottom: 1.5rem; line-height: 0.85; }
        .home-title-main, .home-title-sub {
            font-family: 'Rajdhani', sans-serif; font-weight: 800; color: #fff; text-transform: uppercase;
            display: flex; gap: 0.5em; justify-content: center;
        }
        .home-title-main { font-size: clamp(3rem, 7vw, 6rem); }
        .home-title-sub { font-size: clamp(2rem, 5vw, 4.5rem); }
        .text-fill { color: #fff; }
        .text-stroke { color: transparent; -webkit-text-stroke: 1px #fff; }
        
        .home-countdown { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
        .cd-box {
            background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.2);
            padding: 0.8rem 1.2rem; text-align: center; min-width: 80px; backdrop-filter: blur(5px);
        }
        .cd-number { font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 2rem; color: #fff; display: block; line-height: 1; }
        .cd-label { font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.8rem; color: var(--accent-red); text-transform: uppercase; margin-top: 0.2rem; display: block; }
        
        .next-race-display {
            font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: var(--accent-cyan);
            letter-spacing: 0.2em; text-transform: uppercase; margin-bottom: 3rem; padding: 0.5rem 1rem;
            background: rgba(0, 240, 255, 0.1); border: 1px solid rgba(0, 240, 255, 0.3); border-radius: 4px;
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        }

        .home-cards-container { display: flex; gap: 2rem; width: 100%; max-width: 1200px; padding: 0 2rem; justify-content: center; align-items: stretch; }
        .home-card {
            flex: 1; max-width: 500px; height: 250px; background-size: cover; background-position: center; background-repeat: no-repeat;
            position: relative; border-radius: 4px; overflow: hidden; display: flex; flex-direction: column; justify-content: flex-end;
            padding: 2rem; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-decoration: none;
        }
        .home-card::before {
            content: ''; position: absolute; inset: 0; background: linear-gradient(to right, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 60%, transparent 100%); z-index: 1;
        }
        .home-card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.7); }
        .hc-content { position: relative; z-index: 2; width: 100%; }
        .hc-tag { color: var(--accent-red); font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1.2rem; text-transform: uppercase; margin-bottom: 0.5rem; display: block; }
        .hc-sub { color: #ccc; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.2rem; display: block; }
        .hc-title { color: #fff; font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 2.2rem; text-transform: uppercase; line-height: 1; margin-bottom: 1.5rem; display: block; }
        .hc-btn {
            display: inline-block; padding: 0.6rem 1.5rem; font-family: 'Rajdhani', sans-serif; font-weight: 700; text-transform: uppercase;
            font-size: 0.9rem; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; text-decoration: none; color: #fff; pointer-events: auto;
        }
        .hc-btn-red { background-color: #D00000; }
        .hc-btn-red:hover { background-color: #ff0000; }
        .hc-btn-grey { background-color: #444; color: #fff; }
        .hc-btn-grey:hover { background-color: #666; }
        
        @media (max-width: 900px) {
            .home-cards-container { flex-direction: column; align-items: center; }
            .home-card { width: 100%; height: 200px; }
            .home-title-main, .home-title-sub { font-size: 3rem; }
        }

        /* --- STANDINGS --- */
        .standings-tabs { display: flex; gap: 1rem; margin-bottom: 1rem; overflow-x: auto; padding-bottom: 5px;}
        .tab-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.5);
            padding: 0.5rem 1.5rem; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.9rem;
            text-transform: uppercase; letter-spacing: 0.1em; pointer-events: auto; transition: all 0.3s ease;
            white-space: nowrap; cursor: pointer;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .tab-btn.active { background: var(--accent-red); color: #fff; border-color: var(--accent-red); box-shadow: 0 0 20px rgba(255,31,75,0.3); }

        .standings-wrapper { width: 100%; height: 75vh; margin-top: 0.5rem; position: relative; }
        .standings-view {
            position: absolute; inset: 0; width: 100%; height: 100%;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0; visibility: hidden; transform: translateY(20px); pointer-events: none;
        }
        .standings-view.active-view { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }

        .table-scroll { height: 100%; overflow: auto; padding-right: 1rem; scrollbar-width: none; }
        .table-scroll::-webkit-scrollbar { display: none; }
        
        /* FIXED TABLE STYLES */
        .standings-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0; 
            font-family: 'JetBrains Mono', monospace; 
        }
        
        .standings-table th {
            text-align: left; color: var(--accent-cyan); padding: 0.8rem; position: sticky; top: 0; 
            background: #050505; 
            z-index: 30; 
            font-family: 'Rajdhani', sans-serif; font-weight: 700; letter-spacing: 0.1em;
            white-space: nowrap; font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        
        .standings-table td { 
            padding: 0.8rem; 
            background: var(--glass-bg); 
            border-top: 1px solid transparent; 
            border-bottom: 1px solid transparent; 
            transition: all 0.2s ease; 
            white-space: nowrap; 
            font-size: 0.9rem;
        }

        .standings-table td:first-child, .standings-table th:first-child { position: sticky; left: 0; }
        .standings-table th:first-child { z-index: 40; background: #050505; border-right: 1px solid rgba(255,255,255,0.1); }
        .standings-table td:first-child { 
            z-index: 20; background: #0a0a0a; border-radius: 4px 0 0 4px; 
            border-left: 3px solid var(--team-color, transparent); 
            border-right: 1px solid rgba(255,255,255,0.1);
            box-shadow: 2px 0 5px rgba(0,0,0,0.5);
        }
        .standings-table td:last-child { border-radius: 0 4px 4px 0; border-right: 1px solid transparent; }
        .standings-table tr:hover td { background: rgba(255, 255, 255, 0.1); transform: scale(1.01); }
        .standings-table tr:hover td:first-child { background: #111; } 
        
        .team-cell { display: flex; align-items: center; gap: 0.8rem; }
        .team-logo-mini { height: 20px; width: auto; max-width: 30px; object-fit: contain; }

        /* --- GARAGE GRID --- */
        .garage-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 2rem; 
            height: 100%; 
            overflow-y: auto; 
            padding: 1rem 2rem 4rem 2rem;
            scrollbar-width: none;
            align-items: stretch; 
        }
        .garage-grid::-webkit-scrollbar { display: none; }
        
        .constructor-card {
            background: linear-gradient(135deg, #151515 0%, #050505 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-left: 4px solid var(--team-color);
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%; 
            min-height: 340px; 
            transform-style: preserve-3d;
            will-change: transform; 
            transition: box-shadow 0.3s ease, border-color 0.3s ease; 
        }

        .constructor-card:hover {
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.7), 0 10px 20px -5px rgba(0, 0, 0, 0.5);
            border-color: rgba(255,255,255,0.3);
            z-index: 10;
        }
        
        .cc-pattern {
            position: absolute; bottom: 0; left: 0; margin-bottom: 2rem;
            transform: scale(1.5); opacity: 0.15; pointer-events: none;
            width: 100%; height: auto;
        }
        
        .cc-img-container {
            position: relative;
            height: 180px; 
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 2rem;
        }
        
        .cc-shadow-blob {
            display: block; position: absolute;
            width: 10rem; height: 10rem;
            bottom: 10px; left: 50%; transform: translateX(-50%) rotate3d(1, 0, 0, 60deg);
            background: radial-gradient(circle, rgba(0,0,0,0.8) 0%, transparent 70%);
            opacity: 0.6; pointer-events: none;
            filter: blur(10px);
        }
        
        .cc-car-img {
            position: relative;
            width: 90%;
            height: 100%;
            object-fit: contain; 
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5));
            z-index: 2;
        }

        .cc-content {
            position: relative;
            padding: 1.5rem 2rem;
            margin-top: auto; 
            color: #fff;
            background: linear-gradient(to top, rgba(0,0,0,0.4) 0%, transparent 100%);
            z-index: 5;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .cc-rank-label {
            display: block; opacity: 0.6; 
            font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; letter-spacing: 0.1em;
        }
        
        .cc-info-row {
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        
        .cc-name {
            display: block; font-weight: 800; font-size: 1.6rem;
            font-family: 'Rajdhani', sans-serif; text-transform: uppercase;
            line-height: 1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .cc-points-pill {
            display: flex; align-items: center; justify-content: center;
            background-color: #ffffff;
            color: #000000;
            border-radius: 4px;
            font-size: 0.9rem; font-weight: 800;
            padding: 0.4rem 0.8rem;
            line-height: 1;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-family: 'JetBrains Mono', monospace;
            min-width: 80px;
        }

        /* --- DOTD --- */
        .dotd-accordion-container { width: 100%; height: 100%; display: flex; flex-direction: column; gap: 0; overflow: hidden; }
        @media (min-width: 768px) { .dotd-accordion-container { flex-direction: row; } }
        .dotd-panel {
            flex: 1; display: flex; position: relative; background-size: cover; background-position: center top;
            background-repeat: no-repeat; overflow: hidden; transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            cursor: pointer; min-height: 60px; border: 1px solid rgba(255,255,255,0.05);
        }
        .dotd-panel::before {
            content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.9) 100%);
            z-index: 1; transition: background 0.5s;
        }
        .dotd-panel:hover { flex: 4; cursor: default; border-color: var(--team-color); }
        .dotd-panel:hover::before { background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%); }
        .dotd-label {
            position: absolute; z-index: 2; top: 50%; left: 50%; transform: translate(-50%, -50%);
            white-space: nowrap; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.2rem;
            text-transform: uppercase; color: rgba(255,255,255,0.7); transition: all 0.3s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); pointer-events: none;
        }
        @media (min-width: 768px) {
            .dotd-label { transform: translate(-50%, -50%) rotate(-90deg); font-size: 1.5rem; }
            .dotd-panel:hover .dotd-label { opacity: 0; transform: translate(-50%, -200%) rotate(-90deg); }
        }
        @media (max-width: 767px) {
            .dotd-panel:hover .dotd-label { opacity: 0; transform: translate(-200%, -50%); }
        }
        .dotd-content {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 1.5rem; z-index: 3;
            opacity: 0; transform: translateY(20px); transition: all 0.4s 0.1s ease-out;
            display: flex; flex-direction: column; justify-content: flex-end;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }
        .dotd-panel:hover .dotd-content { opacity: 1; transform: translateY(0); }
        .dotd-gp-name { color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; margin-bottom: 0.5rem; letter-spacing: 1px; }
        .dotd-driver-name { color: #fff; font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 800; line-height: 1; text-transform: uppercase; margin-bottom: 0.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .dotd-team-name { color: var(--team-color); font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 600; text-transform: uppercase; }
        .dotd-badge-icon {
            position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #FFD700; opacity: 0;
            transform: scale(0); transition: all 0.3s 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 4; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));
        }
        .dotd-panel:hover .dotd-badge-icon { opacity: 1; transform: scale(1); }

        /* --- CALENDAR MAP (BRIGHTER) --- */
        .calendar-map-container {
            width: 100%; max-width: 1400px; margin: 0 auto;
            position: relative;
            min-height: 400px; 
            z-index: 20;
            /* Lighter background for better contrast */
            background-image: radial-gradient(rgba(255, 255, 255, 0.15) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .locations {
            position: relative;
            width: 100%;
        }

        .locations img {
            width: 100%;
            height: auto;
            display: block;
            /* EVEN BRIGHTER MAP: Invert creates white landmasses, increased brightness makes it glowing */
            opacity: 0.95;
            filter: grayscale(1) invert(1) brightness(2.5) contrast(1.1); 
            position: relative;
            z-index: 10;
            pointer-events: none; 
        }

        .location_dot {
            display: block;
            width: 10px; height: 10px;
            background-color: var(--accent-cyan);
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            z-index: 30; 
            transition: all 0.3s;
            box-shadow: 0 0 10px var(--accent-cyan);
            pointer-events: auto;
        }
        
        .location_dot::before {
            content: ""; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 30px; height: 30px;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.4) 0%, transparent 70%);
            border-radius: 50%; z-index: -1;
            animation: pulse-cyan 2s infinite;
        }
        
        .location_dot.active {
            background-color: var(--accent-red);
            box-shadow: 0 0 15px var(--accent-red);
            transform: scale(1.5);
            z-index: 40;
        }
        .location_dot.active::before {
             background: radial-gradient(circle, rgba(255, 31, 75, 0.4) 0%, transparent 70%);
             animation: pulse-red 2s infinite;
        }

        @keyframes pulse-cyan { 0% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.8); } 50% { opacity: 0.2; transform: translate(-50%, -50%) scale(1.5); } 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.8); } }
        @keyframes pulse-red { 0% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.8); } 50% { opacity: 0.2; transform: translate(-50%, -50%) scale(1.5); } 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(0.8); } }

        /* --- POPUP CARD (SMALL) --- */
        .location_info {
            display: none;
            position: absolute;
            /* Default: Pop Up, Centered */
            bottom: 25px; left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #fff;
            background: rgba(0, 0, 0, 0.95);
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid var(--accent-cyan);
            width: 240px; 
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0,0,0,1);
            backdrop-filter: blur(10px);
            pointer-events: auto; 
        }

        /* SMART POSITIONING MODIFIERS */
        .location_info.pop-down {
            bottom: auto; 
            top: 25px; 
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-bottom: 3px solid var(--accent-cyan);
        }
        
        .location_info.shift-left {
            left: auto; 
            right: -10px; 
            transform: none;
        }
        
        .location_info.shift-right {
            left: -10px; 
            right: auto; 
            transform: none;
        }
        
        .location_dot:hover .location_info, .location_dot.active .location_info {
            display: flex; flex-direction: column; gap: 0.5rem;
            animation: fadeUp 0.3s ease forwards;
        }

        .location_info img {
            width: 100% !important; 
            height: 100px !important; 
            object-fit: cover; border-radius: 3px; margin-bottom: 0.3rem;
            filter: none !important; opacity: 1 !important; mask-image: none !important;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .li-gp { font-family: 'Rajdhani', sans-serif; font-weight: 800; font-size: 1.1rem; text-transform: uppercase; color: #fff; line-height: 1; }
        .li-date { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--accent-cyan); }
        
        /* NEW INTEL BUTTON STYLE */
        .btn-ai-intel-map {
            margin-top: 0.3rem; 
            padding: 0.5rem; 
            background: var(--accent-cyan);
            border: 1px solid var(--accent-cyan); 
            color: #000; 
            font-family: 'Rajdhani', sans-serif;
            font-weight: 800;
            font-size: 0.8rem; 
            cursor: pointer; 
            transition: all 0.2s;
            text-transform: uppercase; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 6px;
            width: 100%;
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
        }
        .btn-ai-intel-map:hover { 
            background: #fff; 
            color: #000; 
            border-color: #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        @keyframes fadeUp { from { opacity: 0; transform: translateX(-50%) translateY(10px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }

        /* --- HORIZONTAL TRACK LIST (BOTTOM) --- */
        .timeline-ui-wrapper {
            position: relative;
            width: 100%;
            z-index: 60;
            background: rgba(20, 20, 30, 0.6);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
        }

        .track-timeline-container {
            width: 100%;
            overflow-x: auto;
            white-space: nowrap;
            padding: 1rem 0;
            scrollbar-width: none; /* Firefox */
            scroll-behavior: smooth;
        }
        .track-timeline-container::-webkit-scrollbar { display: none; }
        
        .track-timeline-wrapper {
            display: flex;
            gap: 1rem;
            padding: 0 3rem; /* Added padding for arrows */
        }

        .timeline-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 30px; height: 30px;
            background: rgba(0,0,0,0.8);
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            border-radius: 50%;
            cursor: pointer;
            z-index: 70;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
            font-size: 0.8rem;
        }
        .timeline-nav-btn:hover { background: var(--accent-cyan); color: #000; box-shadow: 0 0 10px var(--accent-cyan); }
        .t-prev { left: 10px; }
        .t-next { right: 10px; }

        .timeline-card {
            display: inline-flex;
            flex-direction: column;
            justify-content: center;
            min-width: 140px;
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .timeline-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        .timeline-card.active {
            border-color: var(--accent-cyan);
            background: rgba(0, 240, 255, 0.1);
        }
        
        .tl-round { font-family: 'JetBrains Mono'; font-size: 0.7rem; color: #aaa; margin-bottom: 4px; }
        .tl-gp { font-family: 'Rajdhani'; font-weight: 700; font-size: 1rem; color: #fff; text-transform: uppercase; line-height: 1.1; }
        .tl-date { font-family: 'JetBrains Mono'; font-size: 0.75rem; color: var(--accent-cyan); margin-top: 4px; }

        /* --- MASONRY ARCHIVE GRID (FIXED GAP-LESS) --- */
        /* Variables adapted to CSS Custom Properties */
        :root {
            --spacing-medium: 1rem;
            --spacing-small: 0.5rem;
            --spacing-large: 2rem;
            --box-size: 12rem; /* approx 200px */
        }

        .grid-container {
            display: grid;
            grid-gap: 0; /* NO GAP as requested */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            grid-auto-rows: 200px;
            grid-auto-flow: dense;
            width: 100%;
            padding: 0; /* Remove padding */
            margin: 0;
        }

        .archive-card { /* Renamed from .card to avoid conflicts */
            grid-row: auto / span 1;
            grid-column: auto / span 1;
            background-color: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(255, 255, 255, 0.05); /* Subtle border */
            /* Removed radius for seamless look */
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .archive-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
            transform: scale(1.02); /* Slight scale instead of Y-translation */
            z-index: 5;
        }

        .archive-card h3, .archive-card p {
            margin-top: 0;
            font-weight: normal;
        }

        .archive-card__image {
            height: 100%;
            width: 100%;
            display: flex;
        }

        .archive-card__image img {
            height: 100%;
            width: 100%;
            object-fit: cover;
            filter: brightness(0.8);
            transition: filter 0.3s ease, transform 0.5s ease;
        }

        .archive-card:hover .archive-card__image img {
            filter: brightness(1);
            transform: scale(1.05);
        }

        .archive-card__content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 1rem;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            pointer-events: none;
        }
        
        .archive-card__content h3 {
            color: var(--accent-cyan);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 1.1rem;
            line-height: 1;
            margin-bottom: 0.2rem;
        }
        
        .archive-card__content p {
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            margin: 0;
        }

        /* Layout Modifiers */
        .archive-card--featured {
            grid-row: span 2;
            grid-column: span 2;
        }
        
        .archive-card--2x {
            grid-row: span 2;
            grid-column: span 2;
        }
        
        .archive-card--vertical {
            grid-row: span 2;
        }
        
        .archive-card--horizontal {
            grid-column: span 2;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .grid-container {
                grid-template-columns: 1fr;
                grid-auto-rows: 250px;
            }
            .archive-card {
                min-height: 250px;
                grid-column: auto !important;
                grid-row: auto !important;
            }
        }
        
        @media (min-width: 601px) and (max-width: 1024px) {
             .grid-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- STRATEGY INTEL CARD (BIG) --- */
        /* Modals */
        .modal-overlay {
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.1); 
            backdrop-filter: blur(2px); 
            z-index: 9990; 
            display: block; 
            opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; pointer-events: auto; }
        
        .intel-modal {
            /* BIGGER STRATEGY INTEL CARD */
            width: 90%; 
            max-width: 600px;
            background: #000; 
            border: 1px solid var(--accent-cyan);
            border-radius: 12px;
            padding: 2rem; 
            position: fixed; 
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.9), 0 0 30px rgba(0, 240, 255, 0.15);
            z-index: 9991;
            max-height: 85vh;
            overflow: hidden;
        }

        .intel-title { 
            color: var(--accent-cyan); 
            font-family: 'Rajdhani', sans-serif; 
            font-size: 2rem; 
            margin-bottom: 1rem; 
            text-transform: uppercase; 
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.8rem;
        }
        
        .intel-content-layout {
            display: flex; 
            flex-direction: column; 
            gap: 1.5rem; 
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .intel-content-layout::-webkit-scrollbar { width: 4px; }
        .intel-content-layout::-webkit-scrollbar-track { background: #111; }
        .intel-content-layout::-webkit-scrollbar-thumb { background: var(--accent-cyan); border-radius: 2px; }

        .intel-left-column { 
            width: 100%; 
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        
        .intel-map-container { 
            width: 100%; 
            height: 0; 
            padding-bottom: 50%; 
            position: relative; 
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .intel-map-container img { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            object-fit: contain; 
            filter: brightness(1.2) contrast(1.1);
            padding: 10px;
        }
        
        .ai-briefing { 
            font-family: 'JetBrains Mono', monospace; 
            line-height: 1.5; 
            font-size: 0.9rem;
            color: #ccc; 
            background: transparent;
            padding: 0;
            border: none;
        }
        
        .intel-stat-row {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 0.5rem 0;
            font-size: 1rem;
        }
        
        .intel-section { margin-top: 1rem; }
        .intel-section-title { font-family:'Rajdhani'; font-weight:700; color:#fff; text-transform:uppercase; margin-bottom:0.3rem; letter-spacing:1px; font-size: 1rem; color: var(--accent-red); }
        .intel-section-text { font-size:0.9rem; color:#aaa; line-height:1.4; }

        .close-modal { cursor: pointer; font-size: 1.5rem; color: #fff; transition: color 0.2s; float: right; margin-top: -5px;}
        .close-modal:hover { color: var(--accent-cyan); }

        /* --- IMAGE MODAL --- */
        #img-modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 20000; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        #img-modal-overlay.active { opacity: 1; visibility: visible; pointer-events: auto; } /* Ensure pointer events auto when active */
        .img-modal-content {
            max-width: 90vh; max-height: 90vh;
            display: flex; flex-direction: column;
            position: relative; pointer-events: auto;
        }
        .img-modal-content img {
            max-width: 100%; max-height: 80vh;
            object-fit: contain;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.2);
            background: #000;
        }
        .img-modal-text {
            background: #000; padding: 1rem; text-align: center;
            border: 1px solid var(--accent-cyan); border-top: none;
            color: #fff;
        }
        .close-img-modal {
            position: absolute; top: -40px; right: 0;
            color: #fff; font-size: 2rem; cursor: pointer;
        }
        .close-img-modal:hover { color: var(--accent-cyan); }

        /* Other UI */
        .btn-tech {
            pointer-events: auto; display: inline-block; padding: 0.8rem 2.5rem;
            background: var(--accent-red); color: #fff; font-family: 'Rajdhani'; font-weight: 700;
            text-decoration: none; clip-path: polygon(0 0, 100% 0, 95% 100%, 5% 100%);
            transition: all 0.3s; border: none; font-size: 1rem;
        }
        .btn-tech:hover { background: #fff; color: var(--accent-red); box-shadow: 0 0 20px rgba(255,31,75,0.5); }
        
        /* Contact Grid */
        .contact-grid { display: flex; gap: 2rem; flex-wrap: wrap; margin-top: 2rem; }
        .contact-item {
            display: flex; align-items: center; gap: 1rem; padding: 1.5rem 2rem;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            color: #fff; text-decoration: none; transition: all 0.3s ease; pointer-events: auto;
        }
        .contact-item:hover { background: #fff; color: #000; transform: translateY(-5px); }

        @media (max-width: 768px) {
            .fixed-ui { padding: 1rem; }
            .top-nav { display: none; }
            .slide-title { font-size: 3rem; }
            .garage-grid { grid-template-columns: 1fr; }
            .intel-modal { width: 95%; max-height: 80vh; padding: 1.5rem; }
        }
    </style>
</head>
<body>

    <div id="cursor"></div><div id="cursor-follower"></div>

    <div id="loader">
        <div class="tech-font" style="letter-spacing: 0.3em; font-size: 1.5rem;">INITIALIZING RACE CONTROL</div>
        <div class="loader-bar"><div class="loader-progress" id="load-bar"></div></div>
    </div>

    <div class="fixed-ui">
        <img id="app-logo" src="https://raw.githubusercontent.com/HARISHWINNER/TTRL/ade50d630c482acbb96676fc69c2849a58494f7f/RESOURCES/image.png" alt="TTRL" class="logo hover-target" onclick="navigateTo(0)">
        <div class="header-right">
            <div class="top-nav">
                <a onclick="navigateTo(0)" class="nav-link active hover-target">HOME</a>
                <a onclick="navigateTo(1)" class="nav-link hover-target">CALENDAR</a>
                <a onclick="navigateTo(2)" class="nav-link hover-target">STANDINGS</a>
                <a onclick="navigateTo(3)" class="nav-link hover-target">REGISTER</a>
                <a onclick="navigateTo(4)" class="nav-link hover-target">PADDOCK</a>
                <a onclick="navigateTo(5)" class="nav-link hover-target">ARCHIVES</a>
            </div>
            <div class="mono-font text-sm uppercase tracking-widest"><span style="color: var(--accent-cyan)" id="nav-season-label">Season 1</span> <span style="color: #666">// Live</span></div>
        </div>
    </div>

    <!-- INTEL MODAL (UPDATED TO BE BIG) -->
    <div class="modal-overlay" id="intel-modal-overlay">
        <div class="intel-modal" onclick="event.stopPropagation()">
            <div style="overflow:hidden;">
                <span class="close-modal hover-target" onclick="closeIntel()">&times;</span>
                <span style="color:#666; font-family:'JetBrains Mono'; font-size: 0.8rem; letter-spacing: 2px;">STRATEGY CENTER</span>
            </div>
            <div class="intel-title" id="intel-title">GP NAME</div>
            <div class="intel-content-layout">
                <div class="intel-left-column">
                    <div class="intel-map-container"><img id="intel-map" src="" alt="Map"></div>
                    <div id="ai-briefing" class="ai-briefing"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- IMAGE EXPAND MODAL -->
    <div class="modal-overlay" id="img-modal-overlay" onclick="closeImgModal()" style="opacity: 0; visibility: hidden;">
        <div class="img-modal-content" onclick="event.stopPropagation()">
            <span class="close-img-modal" onclick="closeImgModal()">&times;</span>
            <img id="img-modal-src" src="" alt="Award Poster">
            <div class="img-modal-text">
                <h3 id="img-modal-title" style="color:var(--accent-cyan); font-family:'Rajdhani'; font-weight:800; text-transform:uppercase; margin:0;"></h3>
                <p id="img-modal-desc" style="color:#fff; font-family:'JetBrains Mono'; margin:0;"></p>
            </div>
        </div>
    </div>

    <div class="slides-wrapper">
        <!-- SLIDE 0: HERO -->
        <section class="slide active" id="home">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/a63c5b81b6a861f85d3efb76fe0c9bb2590de507/RESOURCES/f1-cars-race-track-3840x2160-13489.jpg'); opacity:0.8;"></div>

            <div class="slide-content home-design-container">
                <div class="home-title-group">
                    <div class="home-title-main">
                        <span class="text-fill">TURBO</span>
                        <span class="text-stroke">TRIBE</span>
                    </div>
                    <div class="home-title-sub">
                        <span class="text-stroke">RACING</span>
                        <span class="text-fill">LEAGUE</span>
                    </div>
                </div>

                <div class="home-countdown">
                    <div class="cd-box"><span class="cd-number" id="cd-days">00</span><span class="cd-label">DAYS</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-hours">00</span><span class="cd-label">HRS</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-mins">00</span><span class="cd-label">MIN</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-secs">00</span><span class="cd-label">SEC</span></div>
                </div>
                
                <div id="next-race-info" class="next-race-display">
                    SEASON COMPLETED // WAITING FOR SEASON 2
                </div>

                <div class="home-cards-container">
                    <div class="home-card hover-target" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/e892dbee23fd4d1b55f5e04b6ba2bf00f54126e3/RESOURCES/card/button_2.png');">
                        <div class="hc-content">
                            <span class="hc-tag">SEASON 2</span>
                            <span class="hc-sub">YET TO ANNOUNCE</span>
                            <span class="hc-title">LEAGUE RACE</span>
                            <a href="https://docs.google.com/forms/d/e/1FAIpQLSc1xE8SkAOIKoHaryLjNgTNXJfmBCSv73vdgxaAA0_uxnmUTw/viewform" target="_blank" class="hc-btn hc-btn-red hover-target">JOIN NOW</a>
                        </div>
                    </div>

                    <div class="home-card hover-target" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/e892dbee23fd4d1b55f5e04b6ba2bf00f54126e3/RESOURCES/card/button_4.png');">
                        <div class="hc-content">
                            <span class="hc-tag">SPECIAL EVENTS</span>
                            <span class="hc-title" style="margin-top:1.5rem;">SOCIAL RACE</span>
                            <a href="https://discord.com/channels/1345718934174957590/1345721726188912671" target="_blank" class="hc-btn hc-btn-grey hover-target">JOIN NOW</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 1: CALENDAR (UPDATED MAP) -->
        <section class="slide" id="calendar">
            <div class="slide-bg"></div> 
            <div class="slide-content">
                <div class="slide-tag">02 // GLOBAL TOUR</div>
                <h2 class="slide-title tech-font">RACE <span class="text-outline">MAP</span></h2>
                
                <div class="calendar-map-container" id="calendar-map-root">
                     <div class="overflowHidden_onmobile">
                        <div class="locations" id="map-locations">
                             <img src="https://i.ibb.co/QpYG5f2/offices-world-map-e2cc096.png" alt="World Map">
                        </div>
                     </div>
                </div>

                <!-- NEW: Horizontal Track Timeline with Arrows -->
                <div class="timeline-ui-wrapper">
                    <button class="timeline-nav-btn t-prev" id="tl-prev"><i class="fa-solid fa-chevron-left"></i></button>
                    <div class="track-timeline-container" id="timeline-scroll-area">
                        <div class="track-timeline-wrapper" id="track-timeline">
                        </div>
                    </div>
                    <button class="timeline-nav-btn t-next" id="tl-next"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
            </div>
        </section>

        <!-- SLIDE 2: STANDINGS -->
        <section class="slide" id="standings">
            <div class="slide-bg" style="background-image: url('https://f1chronicle.com/wp-content/uploads/2024/01/SI202412010400-1920x1080.jpg')"></div>
            <div class="slide-content">
                <div class="slide-tag">03 // LEADERBOARD</div>
                <h2 class="slide-title tech-font">TOP <span class="text-outline">PERFORMERS</span></h2>
                <div class="standings-tabs">
                    <button class="tab-btn active hover-target" data-tab="drivers">DRIVERS</button>
                    <button class="tab-btn hover-target" data-tab="constructors">TEAMS</button>
                </div>
                <div class="standings-wrapper">
                    <div class="standings-view active-view" id="view-drivers">
                         <div class="table-scroll">
                            <table class="standings-table">
                                <thead><tr><th>POS</th><th>DRIVER</th><th>TEAM</th><th>PTS</th></tr></thead>
                                <tbody id="drivers-body"><tr><td colspan="4" class="archive-loading">CONNECTING TO DATABASE...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="standings-view" id="view-constructors">
                        <div class="garage-grid" id="garage-grid">
                            <div class="archive-loading">CALCULATING POINTS...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 3: REGISTER -->
        <section class="slide" id="register">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/577532eaacf8de58ca32f2b9e5d0112cf71a3689/RESOURCES/1-w-GettyImages-2048270135.webp')"></div>
            <div class="slide-content">
                <div class="slide-tag">04 // ENLIST</div>
                <h2 class="slide-title tech-font">JOIN <span class="text-outline">THE GRID</span></h2>
                <div class="btn-container"><a href="https://docs.google.com/forms/d/e/1FAIpQLSc1xE8SkAOIKoHaryLjNgTNXJfmBCSv73vdgxaAA0_uxnmUTw/viewform" target="_blank" class="btn-tech hover-target">REGISTER NOW</a></div>
            </div>
        </section>

         <!-- SLIDE 4: PADDOCK -->
        <section class="slide" id="paddock">
            <div class="slide-bg" id="vanta-bg"></div>
            <div class="slide-content">
                <div class="slide-tag">05 // PADDOCK</div>
                <h2 class="slide-title tech-font">CONNECT <span class="text-outline">WITH US</span></h2>
                <div class="contact-grid mono-font">
                    <a href="https://discord.gg/EuyPTXqbg6" target="_blank" class="contact-item hover-target"><i class="fa-brands fa-discord"></i> <span>DISCORD</span></a>
                    <a href="https://www.youtube.com/@TurboTribeRacingLeague" target="_blank" class="contact-item hover-target"><i class="fa-brands fa-youtube"></i> <span>YOUTUBE</span></a>
                    <a href="mailto:turbotriberacingleague@gmail.com" class="contact-item hover-target"><i class="fa-solid fa-envelope"></i> <span>EMAIL</span></a>
                </div>
            </div>
        </section>

        <!-- SLIDE 5: ARCHIVES -->
        <section class="slide" id="archives">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/a63c5b81b6a861f85d3efb76fe0c9bb2590de507/RESOURCES/001-EA-Sports-F1-2023-Video-Game-Review.jpg'); filter: brightness(0.2);"></div>
            <div class="slide-content">
                <div class="slide-tag">06 // DATA VAULT</div>
                <h2 class="slide-title tech-font">SEASON <span class="text-outline">ARCHIVES</span></h2>
                
                <div class="archive-controls">
                    <div class="season-btn-group">
                        <button class="tab-btn active" onclick="setSeason('season_1')">SEASON 1</button>
                        <button class="tab-btn" onclick="setSeason('season_2')">SEASON 2</button>
                    </div>
                </div>

                <!-- UPDATED TABS -->
                <div class="standings-tabs" style="justify-content: center;">
                    <button class="tab-btn active hover-target" data-tab="archive-drivers">DRIVERS</button>
                    <button class="tab-btn hover-target" data-tab="archive-teams">TEAMS</button>
                    <button class="tab-btn hover-target" data-tab="archive-calendar">CALENDAR</button>
                    <button class="tab-btn hover-target" data-tab="archive-dotd">DOTD</button>
                    <button class="tab-btn hover-target" data-tab="archive-season-awards">SEASON AWARDS</button>
                </div>

                <div class="standings-wrapper" style="height: 55vh;">
                    <!-- DRIVER ARCHIVE -->
                    <div class="standings-view active-view" id="view-archive-drivers">
                        <div class="table-scroll" id="archives-drivers-container">
                             <div class="archive-loading">LOADING DRIVER MATRIX...</div>
                        </div>
                    </div>

                    <!-- TEAM ARCHIVE -->
                    <div class="standings-view" id="view-archive-teams">
                        <div class="table-scroll" id="archives-teams-container">
                             <div class="archive-loading">LOADING TEAM MATRIX...</div>
                        </div>
                    </div>

                    <!-- CALENDAR ARCHIVE -->
                    <div class="standings-view" id="view-archive-calendar">
                        <div id="archive-calendar-grid" class="cal-grid">
                             <div class="archive-loading">LOADING CALENDAR...</div>
                        </div>
                    </div>

                    <!-- DOTD ARCHIVE -->
                    <div class="standings-view" id="view-archive-dotd">
                        <div class="dotd-accordion-container" id="dotd-container"></div>
                    </div>

                    <!-- NEW: SEASON AWARDS ARCHIVE (BENTO GRID) -->
                    <div class="standings-view" id="view-archive-season-awards">
                        <div class="table-scroll">
                            <div class="awards-grid" id="season-awards-grid"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyApUD33ao9DfFa8IAfA2qby3IFKhLtcNFU",
            authDomain: "ttrl-9f3ef.firebaseapp.com",
            projectId: "ttrl-9f3ef",
            storageBucket: "ttrl-9f3ef.firebasestorage.app",
            messagingSenderId: "51144639440",
            appId: "1:51144639440:web:8a027b773bc2cddefe2fd5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); // Initialize Auth

        // CONSTANTS
        const TEAMS = [
            {id:'red-bull-racing', name:'Red Bull'}, {id:'ferrari', name:'Ferrari'}, {id:'mercedes', name:'Mercedes'},
            {id:'mclaren', name:'McLaren'}, {id:'aston-martin', name:'Aston Martin'}, {id:'alpine', name:'Alpine'},
            {id:'williams', name:'Williams'}, {id:'racing-bulls', name:'Racing Bulls'}, {id:'kick-sauber', name:'Kick Sauber'},
            {id:'haas', name:'Haas'}, {id:'reserve', name:'Reserve'}
        ];
        
        // Static Metadata for Tracks
        const TRACK_METADATA = {
            'bahrain': { gp: "Bahrain Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677245035/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Bahrain_Circuit.png", insight: "Stop and go track." },
            'saudi_arabia': { gp: "Saudi Arabian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244985/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Saudi_Arabia_Circuit.png", insight: "Fastest street circuit." },
            'australia': { gp: "Australian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244985/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Australia_Circuit.png", insight: "Fast flowing street circuit." },
            'japan': { gp: "Japanese Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244987/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Japan_Circuit.png", insight: "Figure 8 layout." },
            'china': { gp: "Chinese Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244984/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/China_Circuit.png", insight: "Technical sectors." },
            'miami': { gp: "Miami Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244985/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Miami_Circuit.png", insight: "Technical street circuit." },
            'emilia_romagna': { gp: "Emilia Romagna Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244984/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Emilia_Romagna_Circuit.png", insight: "Narrow and technical." },
            'monaco': { gp: "Monaco Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244984/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Monaco_Circuit.png", insight: "The jewel in the crown." },
            'canada': { gp: "Canadian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244984/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Canada_Circuit.png", insight: "Wall of champions." },
            'spain': { gp: "Spanish Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244986/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Spain_Circuit.png", insight: "Test of aerodynamics." },
            'austria': { gp: "Austrian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244983/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Austria_Circuit.png", insight: "Short power lap." },
            'uk': { gp: "British Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244984/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Great_Britain_Circuit.png", insight: "High speed corners." },
            'hungary': { gp: "Hungarian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244986/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Hungary_Circuit.png", insight: "Monaco without walls." },
            'belgium': { gp: "Belgian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244983/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Belgium_Circuit.png", insight: "Longest track on calendar." },
            'netherlands': { gp: "Dutch Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244984/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Netherlands_Circuit.png", insight: "Banked corners." },
            'italy': { gp: "Italian Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244986/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Italy_Circuit.png", insight: "Temple of Speed." },
            'azerbaijan': { gp: "Azerbaijan Grand Prix", mapUrl: "https://media.formula1.com/image/upload/c_lfill,w_3392/q_auto/v1740000000/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Baku_Circuit.webp", insight: "Castle section." },
            'baku': { gp: "Azerbaijan Grand Prix", mapUrl: "https://media.formula1.com/image/upload/c_lfill,w_3392/q_auto/v1740000000/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Baku_Circuit.webp", insight: "Castle section." }, // Alias
            'singapore': { gp: "Singapore Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244986/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Singapore_Circuit.png", insight: "Night race endurance." },
            'usa': { gp: "United States Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244987/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/USA_Circuit.png", insight: "Elevation changes." },
            'mexico': { gp: "Mexico City Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244985/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Mexico_Circuit.png", insight: "High altitude." },
            'brazil': { gp: "So Paulo Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244983/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Brazil_Circuit.png", insight: "Classic anti-clockwise track." },
            'las_vegas': { gp: "Las Vegas Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244985/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Las_Vegas_Circuit.png", insight: "High speed street fight." },
            'qatar': { gp: "Qatar Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244985/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Qatar_Circuit.png", insight: "Fast flowing." },
            'abu_dhabi': { gp: "Abu Dhabi Grand Prix", mapUrl: "https://media.formula1.com/image/upload/f_auto/q_auto/v1677244983/content/dam/fom-website/2018-redesign-assets/Circuit%20maps%2016x9/Abu_Dhabi_Circuit.png", insight: "Season finale." }
        };
        
        // Detailed Track Intel (Turns, 50% Laps, Fact, Overtake, ERS)
        const TRACK_INTEL = {
            "azerbaijan": {
                turns: 20,
                laps50: 26,
                fact: "Features the narrowest section on the calendar (7.6m wide past the old city walls) and the longest full-throttle section (2.2km).",
                overtake: "Turn 1 is the primary spot after the massive 2.2km straight. Turn 3 is also possible with DRS.",
                ers: "Crucial for the main straight. Save heavily in sector 2 to deploy fully from Turn 16 to Turn 1."
            },
            "bahrain": {
                turns: 15,
                laps50: 29,
                fact: "The track surface is made of Graywacke aggregate, shipped from England, offering high grip but high tyre degradation.",
                overtake: "Turn 1 and Turn 4 are the best spots. DRS zones on the main straight and the run to Turn 4 are powerful.",
                ers: "Deploy early on the main straight and the back straight. Harvest in the twisty middle sector."
            },
            "saudi_arabia": {
                turns: 27,
                laps50: 25,
                fact: "The fastest street circuit on the calendar with average speeds exceeding 250km/h.",
                overtake: "Turn 1 and Turn 27 (final corner run). DRS is very potent here.",
                ers: "Continuous deployment is needed due to high speeds. Harvest in the few braking zones available."
            },
            "australia": {
                turns: 14,
                laps50: 29,
                fact: "A street circuit in a park. Recent changes have made it much faster, removing the chicane in Sector 2.",
                overtake: "Turn 1 and Turn 11. With 4 DRS zones, staying within 1 second is vital.",
                ers: "Balanced usage. Save for the blasts down the start/finish and the lakeside drive."
            },
            // Add other tracks similarly or use generic fallback
        };

        const TRACK_COORDINATES = {
            'bahrain': { top: 42, left: 62 },
            'saudi_arabia': { top: 44, left: 60 },
            'australia': { top: 75, left: 88 },
            'japan': { top: 36, left: 86 },
            'china': { top: 38, left: 78 },
            'miami': { top: 42, left: 24 },
            'emilia_romagna': { top: 32, left: 52 },
            'monaco': { top: 33, left: 51 },
            'canada': { top: 30, left: 24 },
            'spain': { top: 34, left: 49 },
            'austria': { top: 31, left: 53 },
            'uk': { top: 27, left: 49 },
            'hungary': { top: 31, left: 54 },
            'belgium': { top: 29, left: 51 },
            'netherlands': { top: 28, left: 51 },
            'italy': { top: 32, left: 52 },
            'azerbaijan': { top: 34, left: 63 }, 
            'baku': { top: 34, left: 63 }, 
            'singapore': { top: 55, left: 78 },
            'usa': { top: 40, left: 18 },
            'mexico': { top: 45, left: 18 },
            'brazil': { top: 65, left: 32 },
            'las_vegas': { top: 37, left: 14 },
            'qatar': { top: 43, left: 61 },
            'abu_dhabi': { top: 44, left: 63 }
        };

        const TEAM_COLORS = {
            "red-bull-racing": "#3671C6", "ferrari": "#E80020", "mercedes": "#27F4D2", "mclaren": "#FF8000",
            "aston-martin": "#229971", "alpine": "#0093CC", "williams": "#64C4FF", "racing-bulls": "#6692FF",
            "kick-sauber": "#52E252", "haas": "#B6BABD", "reserve": "#666666"
        };
        const CAR_IMAGES = {
            "red-bull-racing": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025redbullracingcarright.png",
            "ferrari": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025ferraricarright.png",
            "mercedes": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mercedescarright.png",
            "mclaren": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mclarencarright.png",
            "aston-martin": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025astonmartincarright.png",
            "alpine": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025alpinecarright.png",
            "williams": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025williamscarright.png",
            "racing-bulls": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025racingbullscarright.png",
            "kick-sauber": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025kicksaubercarright.png",
            "haas": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025haasf1teamcarright.png"
        };

        const DOTD_DATA = [
            { gp: "Bahrain Grand Prix", driver: "Sanju Vibhi", team: "ASTON MARTIN", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sanju.png", desc: "Voted Driver of the Day for a stellar performance." },
            { gp: "Australian Grand Prix", driver: "Apex Entropy", team: "KICK SAUBER", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Apex%201.png", desc: "Exceptional pace down under at Albert Park." },
            { gp: "Emilia Romagna GP", driver: "Mahesh", team: "WILLIAMS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Mahesh.png", desc: "A fan-favorite drive at Imola's historic circuit." },
            { gp: "Spanish Grand Prix", driver: "Apex Entropy", team: "ALPINE", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Apex.png", desc: "Superb driving at Catalunya earned the fans' vote." },
            { gp: "Great Britain GP", driver: "Sanju Vibhi", team: "ASTON MARTIN", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sanju%201.png", desc: "A standout performance at Silverstone." },
            { gp: "Las Vegas Grand Prix", driver: "Harish", team: "HAAS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Harish.png", desc: "Electrifying drive on the Vegas Strip." },
            { gp: "Belgian Grand Prix", driver: "Sandeep Mareedu", team: "RACING BULLS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sandeep.png", desc: "Incredible drive as a reserve for Racing Bulls." },
            { gp: "Austrian Grand Prix", driver: "Wi7ard", team: "WILLIAMS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Wizard.png", desc: "Magical performance at the Red Bull Ring." },
            { gp: "So Paulo Grand Prix", driver: "TheGodfather", team: "ALPINE", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Godfather.png", desc: "An offer Interlagos couldn't refuse." },
            { gp: "Abu Dhabi Grand Prix", driver: "Wi7ard", team: "WILLIAMS", image: "https://github.com/S-HARISH44/TTRL/blob/ef6d28c8baa4a8e9c15f64a76f854e80a95fadbc/RESOURCES/DOTD/Lime_Green_and_Black_Dynamic_Match_Instagram_Post_4.png?raw=true", desc: "Dominant performance to end the season." }
        ];
        
        const SEASON_AWARDS = [
            { title: "Driver Champion", winner: "Wi7ard", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/winner.png" },
            { title: "Driver of the Season", winner: "Simman", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/season%20driver.png" },
            { title: "Team Champions", winner: "Williams", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/team%20winner.png" },
            { title: "Team of the Season", winner: "Alpine", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/2nd%20runner.png" },
            { title: "Cleanest Driver", winner: "The Godfather", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/cleanest%20driver.png" },
            { title: "The Super Sub", winner: "Sandeep", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/the%20super%20sub.png" },
            { title: "Rain Master", winner: "Harish", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/rain%20master.png" },
            { title: "The Underdog", winner: "Kentucky", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/underdog%20(1).png" },
            { title: "Most Consistent Driver", winner: "Apex Entropy", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/consistent%20driver.png" },
            { title: "Emerging Driver", winner: "Vibin", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/emerging%20driver.png" }
        ];

        // Separate data for Active Season vs Archive View
        let mainSeasonId = 'season_1'; 
        let archiveSeasonId = 'season_1';

        let mainDrivers = [];
        let mainTracks = [];
        let archiveDrivers = [];
        let archiveTracks = [];

        let unsubscribeMain = null;
        let unsubscribeArchive = null;

        const intelModal = document.getElementById('intel-modal-overlay');
        const intelTitle = document.getElementById('intel-title');
        const intelMap = document.getElementById('intel-map');
        const aiBriefing = document.getElementById('ai-briefing');

        function closeIntel() { intelModal.classList.remove('active'); }
        window.closeIntel = closeIntel; // EXPOSE FOR HTML
        
        // --- NEW: Image Modal Functions ---
        function closeImgModal() {
            const modal = document.getElementById('img-modal-overlay');
            modal.classList.remove('active');
            setTimeout(() => {
                 document.getElementById('img-modal-src').src = "";
            }, 300);
        }
        window.closeImgModal = closeImgModal;

        window.openImageModal = (src, title, winner) => {
            const modal = document.getElementById('img-modal-overlay');
            const img = document.getElementById('img-modal-src');
            const t = document.getElementById('img-modal-title');
            const d = document.getElementById('img-modal-desc');
            
            img.src = src;
            t.innerText = title;
            d.innerText = `WINNER: ${winner}`;
            
            modal.classList.add('active');
        }
        
        // --- CLOSE MODALS ON OVERLAY CLICK ---
        document.getElementById('intel-modal-overlay').addEventListener('click', (e) => {
             // If the click target IS the overlay (meaning not the card inside it), close.
             if(e.target.id === 'intel-modal-overlay') {
                 closeIntel();
             }
        });
        document.getElementById('img-modal-overlay').addEventListener('click', (e) => {
             if(e.target.id === 'img-modal-overlay') {
                 closeImgModal();
             }
        });

        async function fetchTrackIntel(trackId) {
            // 1. Activate Overlay
            intelModal.classList.add('active');
            
            // 2. Reset Position
            const card = document.querySelector('.intel-modal');
            // Ensure card is reset to CSS defaults in case JS modified it previously
            card.style.position = '';
            card.style.top = '';
            card.style.left = '';
            card.style.transform = '';
            
            // 3. Populate Data
            // FIX: Normalize ID to lowercase to ensure matching works even if data is capitalized (e.g. "Azerbaijan")
            const normalizedId = (trackId || "").toLowerCase().replace(" grand prix", "").replace(" gp", "").trim().replace(/\s+/g, '_');
            const lookupId = Object.keys(TRACK_INTEL).find(k => normalizedId.includes(k)) || "azerbaijan";

            requestAnimationFrame(async () => {
                const meta = TRACK_METADATA[normalizedId] || TRACK_METADATA[lookupId] || TRACK_METADATA['baku'] || { gp: trackId.toUpperCase(), mapUrl: 'https://placehold.co/768x432/111111/FFFFFF?text=MAP+NOT+FOUND', insight: "No specific intelligence data available for this circuit." };
                const intel = TRACK_INTEL[lookupId] || TRACK_INTEL["azerbaijan"]; 
                
                const gpName = meta.gp || "GRAND PRIX";
                
                intelTitle.innerText = gpName.toUpperCase();
                intelMap.src = meta.mapUrl;
                
                aiBriefing.innerHTML = `
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:2rem; margin-bottom:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:1rem;">
                        <div>
                            <div style="color:#666; font-size:0.75rem; letter-spacing:1px;">TURNS</div>
                            <div style="color:#fff; font-weight:700; font-size: 1.2rem;">${intel.turns}</div>
                        </div>
                        <div>
                            <div style="color:#666; font-size:0.75rem; letter-spacing:1px;">50% LAPS</div>
                            <div style="color:var(--accent-red); font-weight:700; font-size: 1.2rem;">${intel.laps50}</div>
                        </div>
                    </div>
                    
                    <div class="intel-section">
                        <div class="intel-section-title">CIRCUIT FACT</div>
                        <div class="intel-section-text">${intel.fact}</div>
                    </div>

                    <div class="intel-section">
                        <div class="intel-section-title">OVERTAKING</div>
                        <div class="intel-section-text">${intel.overtake}</div>
                    </div>

                    <div class="intel-section">
                        <div class="intel-section-title">ERS STRATEGY</div>
                        <div class="intel-section-text">${intel.ers}</div>
                    </div>
                `;
            });
        }
        window.fetchTrackIntel = fetchTrackIntel; // EXPOSE FOR HTML

        // --- ROUTER LOGIC (IMPROVED) ---
        const slides = document.querySelectorAll('.slide');
        let currentIndex = 0;
        let isAnimating = false;

        // Directly Navigate Function
        window.navigateTo = (index) => {
             // Stop if already there or animating
             if(isAnimating || index === currentIndex) return;
             
             // Update URL hash without triggering duplicate events
             const hashes = ['#home', '#calendar', '#standings', '#register', '#paddock', '#archives'];
             history.pushState(null, null, hashes[index]);
             
             gotoSlide(index);
        };

        function handleHashChange() {
            const hashes = ['#home', '#calendar', '#standings', '#register', '#paddock', '#archives'];
            const hash = window.location.hash || '#home';
            let index = hashes.indexOf(hash);
            if(index === -1) index = 0; // Default to home
            
            gotoSlide(index);
        }

        // --- CORE APP LOGIC ---
        
        async function initAppLogic() {
            console.log("Initializing App Logic...");
            
            // 1. Detect if Season 2 is active (has tracks)
            try {
                const s2Ref = doc(db, "seasons", "season_2");
                const s2Snap = await getDoc(s2Ref);
                
                if (s2Snap.exists() && s2Snap.data().trackConfig && s2Snap.data().trackConfig.length > 0) {
                    mainSeasonId = "season_2";
                } else {
                    mainSeasonId = "season_1";
                }
            } catch (e) {
                console.warn("Error detecting season, defaulting to 1", e);
                mainSeasonId = "season_1";
            }

            console.log("Main Season Set To:", mainSeasonId);
            const label = document.getElementById("nav-season-label");
            if(label) label.innerText = mainSeasonId.replace('_', ' ').replace(/\b\w/g, c => c.toUpperCase());

            // 2. Load Data Independently
            loadMainData(mainSeasonId);
            loadArchiveData('season_1'); // Default archive view
        }

        // A. Load Main Data (Home, Calendar, Standings)
        async function loadMainData(seasonId) {
            try {
                // Get Tracks
                const sDoc = await getDoc(doc(db, "seasons", seasonId));
                mainTracks = (sDoc.exists() && sDoc.data().trackConfig) ? sDoc.data().trackConfig : [];
                mainTracks.sort((a, b) => new Date(a.date || '9999-12-31') - new Date(b.date || '9999-12-31'));

                // Get Drivers (Live Listener)
                if(unsubscribeMain) unsubscribeMain();
                const q = query(collection(db, "seasons", seasonId, "drivers"), orderBy("totalPoints", "desc"));
                
                unsubscribeMain = onSnapshot(q, (snapshot) => {
                    mainDrivers = [];
                    snapshot.forEach(doc => mainDrivers.push(doc.data()));
                    
                    // Render Main Views
                    renderCalendar();
                    renderDrivers();
                    renderConstructors();
                    updateCountdown();
                });
            } catch(e) { console.error("Main Data Load Error:", e); }
        }

        // B. Load Archive Data (Archive Section Only)
        window.setSeason = (sid) => {
            document.querySelectorAll('.season-btn-group .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().replace(' ', '_') === sid) btn.classList.add('active');
            });
            loadArchiveData(sid);
        };

        async function loadArchiveData(seasonId) {
            archiveSeasonId = seasonId;
            console.log("Loading Archive:", seasonId);
            
            try {
                // Get Tracks
                const sDoc = await getDoc(doc(db, "seasons", seasonId));
                archiveTracks = (sDoc.exists() && sDoc.data().trackConfig) ? sDoc.data().trackConfig : [];
                archiveTracks.sort((a, b) => new Date(a.date || '9999-12-31') - new Date(b.date || '9999-12-31'));

                // Get Drivers (Snapshot for archives too, allows seamless switching)
                if(unsubscribeArchive) unsubscribeArchive();
                const q = query(collection(db, "seasons", seasonId, "drivers"), orderBy("totalPoints", "desc"));
                
                unsubscribeArchive = onSnapshot(q, (snapshot) => {
                    archiveDrivers = [];
                    snapshot.forEach(doc => archiveDrivers.push(doc.data()));
                    
                    // Render Archive Views
                    renderArchiveDrivers();
                    renderArchiveTeams();
                    renderArchiveCalendar();
                });
            } catch(e) { console.error("Archive Load Error:", e); }
        }

        // --- RENDERERS ---

        // 1. DRIVER STANDINGS (Main)
        function renderDrivers() {
            const tbody = document.getElementById("drivers-body");
            if(!tbody) return;
            tbody.innerHTML = "";
            
            const sortedDrivers = [...mainDrivers].sort((a, b) => {
                if (a.team === 'reserve' && b.team !== 'reserve') return 1;
                if (a.team !== 'reserve' && b.team === 'reserve') return -1;
                return b.totalPoints - a.totalPoints;
            });

            sortedDrivers.forEach((d, i) => {
                const color = TEAM_COLORS[d.team] || '#fff';
                let teamName = TEAMS.find(t => t.id === d.team)?.name || d.team;
                
                if(d.team === 'reserve') {
                    const subTeams = new Set();
                    if(d.results) Object.values(d.results).forEach(r => {
                        if(typeof r === 'object' && r.team && r.team !== 'reserve') subTeams.add(TEAMS.find(t => t.id === r.team)?.name);
                    });
                    if(subTeams.size > 0) teamName += ` (${Array.from(subTeams).join(', ')})`;
                }

                tbody.innerHTML += `<tr style="--team-color: ${color}">
                    <td style="color:${i<3?['#FFD700','#C0C0C0','#CD7F32'][i]:'inherit'}">${String(i+1).padStart(2,'0')}</td>
                    <td style="font-weight:700">${d.name}</td>
                    <td style="text-transform:uppercase; font-size:0.8rem; letter-spacing:1px; opacity:0.8">${teamName}</td>
                    <td style="color:var(--accent-cyan); font-weight:700">${d.totalPoints}</td>
                </tr>`;
            });
        }

        // 2. CONSTRUCTOR STANDINGS (Main)
        function renderConstructors() {
            const teamPoints = {};
            TEAMS.forEach(t => { if(t.id !== 'reserve') teamPoints[t.id] = 0; });

            mainDrivers.forEach(d => {
                const results = d.results || {};
                Object.values(results).forEach(r => {
                    let pts = 0;
                    let teamId = d.team;
                    if (typeof r === 'object') {
                        pts = Number(r.points || 0);
                        teamId = r.team || d.team;
                    } else {
                        pts = Number(r || 0);
                    }
                    if (teamId !== 'reserve' && teamPoints[teamId] !== undefined) {
                        teamPoints[teamId] += pts;
                    }
                });
            });

            const sortedTeams = Object.keys(teamPoints)
                .map(id => ({ id, name: TEAMS.find(t=>t.id===id).name, points: teamPoints[id] }))
                .sort((a,b) => b.points - a.points);

            const grid = document.getElementById('garage-grid');
            if(!grid) return;

            grid.innerHTML = sortedTeams.map((c, i) => {
                const color = TEAM_COLORS[c.id];
                return `
                <div class="constructor-card hover-target" style="--team-color: ${color}">
                    <svg class="cc-pattern" viewBox="0 0 375 283" fill="none">
                        <rect x="159.52" y="175" width="152" height="152" rx="8" transform="rotate(-45 159.52 175)" fill="${color}"/>
                        <rect y="107.48" width="152" height="152" rx="8" transform="rotate(-45 0 107.48)" fill="${color}"/>
                    </svg>
                    <div class="cc-img-container">
                        <div class="cc-shadow-blob"></div>
                        <img src="${CAR_IMAGES[c.id] || 'https://placehold.co/300x100?text=Car'}" class="cc-car-img" alt="${c.name}">
                    </div>
                    <div class="cc-content">
                        <span class="cc-rank-label">POS ${String(i+1).padStart(2,'0')}</span>
                        <div class="cc-info-row">
                            <span class="cc-name">${c.name}</span>
                            <span class="cc-points-pill">${c.points} PTS</span>
                        </div>
                    </div>
                </div>`;
            }).join('');
            
            if (!window.matchMedia("(pointer: coarse)").matches) {
                document.querySelectorAll('.constructor-card').forEach(card => {
                    card.addEventListener('mousemove', (e) => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left - rect.width/2;
                        const y = e.clientY - rect.top - rect.height/2;
                        gsap.to(card, { transform: `perspective(1000px) rotateX(${-y/10}deg) rotateY(${x/10}deg) scale3d(1.02, 1.02, 1.02)`, duration: 0.1 });
                    });
                    card.addEventListener('mouseleave', () => { gsap.to(card, { transform: `perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`, duration: 0.5 }); });
                });
            }
        }

        // 3. ARCHIVE DRIVERS (Matrix)
        function renderArchiveDrivers() {
            const container = document.getElementById("archives-drivers-container");
            if(!container) return;
            
            if(!archiveTracks || archiveTracks.length === 0) {
                container.innerHTML = `<div class="archive-loading">NO TRACK DATA FOR THIS SEASON</div>`;
                return;
            }

            let html = `<table class="standings-table">`;
            html += `<thead><tr><th class="sticky-corner">DRIVER</th>`;
            archiveTracks.forEach(t => {
                const label = t.id ? t.id.substring(0, 3).toUpperCase() : "UNK"; 
                html += `<th class="sticky-top" style="text-align:center">${label}</th>`;
            });
            html += `<th class="sticky-top" style="text-align:center">TOTAL</th></tr></thead><tbody>`;

            const sortedDrivers = [...archiveDrivers].sort((a, b) => b.totalPoints - a.totalPoints);

            sortedDrivers.forEach(d => {
                const results = d.results || {};
                const tColor = TEAM_COLORS[d.team] || '#fff';
                
                html += `<tr style="--team-color: ${tColor}">`;
                html += `<td class="sticky-left" style="font-weight:700; background:var(--glass-bg); border-left:3px solid ${tColor}">${d.name}</td>`;
                
                archiveTracks.forEach(t => {
                    let pts = '-';
                    if (results[t.id]) {
                        const val = typeof results[t.id] === 'object' ? results[t.id].points : results[t.id];
                        if (val > 0) { pts = val; }
                    }
                    html += `<td style="text-align:center; opacity:${pts === '-' ? 0.3 : 1}">${pts}</td>`;
                });
                
                html += `<td style="text-align:center; color:var(--accent-cyan); font-weight:700">${d.totalPoints}</td></tr>`;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // 4. ARCHIVE TEAMS (Matrix)
        function renderArchiveTeams() {
            const container = document.getElementById("archives-teams-container");
            if(!container) return;
            
            if(!archiveTracks || archiveTracks.length === 0) {
                container.innerHTML = `<div class="archive-loading">NO TRACK DATA</div>`;
                return;
            }

            const teamTrackPoints = {};
            TEAMS.forEach(t => {
                if (t.id === 'reserve') return;
                teamTrackPoints[t.id] = { total: 0 };
                archiveTracks.forEach(tr => teamTrackPoints[t.id][tr.id] = 0);
            });

            archiveDrivers.forEach(d => {
                const results = d.results || {};
                Object.keys(results).forEach(trackKey => {
                    if(!archiveTracks.some(at => at.id === trackKey)) return;
                    
                    const r = results[trackKey];
                    let pts = 0, teamId = d.team;

                    if (typeof r === 'object') { pts = Number(r.points || 0); teamId = r.team || d.team; }
                    else { pts = Number(r || 0); }

                    if(teamId !== 'reserve' && teamTrackPoints[teamId]) {
                        teamTrackPoints[teamId][trackKey] += pts;
                        teamTrackPoints[teamId].total += pts;
                    }
                });
            });

            const sortedTeamIds = Object.keys(teamTrackPoints).sort((a,b) => teamTrackPoints[b].total - teamTrackPoints[a].total);

            let html = `<table class="standings-table">`;
            html += `<thead><tr><th class="sticky-corner">TEAM</th>`;
            archiveTracks.forEach(t => {
                const label = t.id ? t.id.substring(0, 3).toUpperCase() : "UNK";
                html += `<th class="sticky-top" style="text-align:center">${label}</th>`
            });
            html += `<th class="sticky-top" style="text-align:center">TOTAL</th></tr></thead><tbody>`;

            sortedTeamIds.forEach(tId => {
                const tColor = TEAM_COLORS[tId];
                const tName = TEAMS.find(t => t.id === tId)?.name;
                
                html += `<tr style="--team-color: ${tColor}">`;
                html += `<td class="sticky-left" style="font-weight:700; background:var(--glass-bg); border-left:3px solid ${tColor}; text-transform:uppercase;">${tName}</td>`;
                
                archiveTracks.forEach(t => {
                    const pts = teamTrackPoints[tId][t.id];
                    html += `<td style="text-align:center; opacity:${pts === 0 ? 0.3 : 1}">${pts > 0 ? pts : '-'}</td>`;
                });
                html += `<td style="text-align:center; color:var(--accent-cyan); font-weight:700">${teamTrackPoints[tId].total}</td></tr>`;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // 5. ARCHIVE CALENDAR (New)
        function renderArchiveCalendar() {
            const grid = document.getElementById('archive-calendar-grid');
            if(!grid) return;

            if(!archiveTracks || archiveTracks.length === 0) {
                grid.innerHTML = `<div class="archive-loading">CALENDAR EMPTY FOR THIS SEASON</div>`;
                return;
            }

            grid.innerHTML = archiveTracks.map((r, i) => {
                const meta = TRACK_METADATA[r.id] || { gp: r.name, insight: "Global Tour" };
                const displayGP = meta.gp.replace(' Grand Prix', '').replace(' GP', '').toUpperCase();
                
                let dateDisplay = "TBD";
                if(r.date) {
                    const d = new Date(r.date);
                    dateDisplay = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getFullYear()).slice(-2)}`;
                }

                return `<div class="cal-item">
                    <span class="round">RD ${String(i+1).padStart(2,'0')}</span>
                    <span class="gp">${displayGP}</span>
                    <span class="date">${dateDisplay}</span>
                </div>`;
            }).join('');
        }

        // --- CALENDAR RENDERER (UPDATED: MAP + TIMELINE) ---
        function renderCalendar() {
            const container = document.getElementById('map-locations');
            const timelineContainer = document.getElementById('track-timeline');

            if(!container) return;
            
            // Clear existing elements
            container.querySelectorAll('.location_dot').forEach(d => d.remove());
            if(timelineContainer) timelineContainer.innerHTML = '';
            
            if(!mainTracks || mainTracks.length === 0) {
                // Show fallback message
                const msg = document.createElement('div');
                msg.innerHTML = "SEASON DATA LOADING...";
                msg.className = "archive-loading";
                msg.style.position = "absolute"; msg.style.top = "50%"; msg.style.left="50%"; msg.style.transform="translate(-50%,-50%)";
                container.appendChild(msg);
                return;
            }

            // Find next race for highlighting
            const now = new Date();
            let nextRaceIndex = -1;
            for(let i=0; i<mainTracks.length; i++) {
                if(mainTracks[i].date && new Date(mainTracks[i].date) >= now) {
                    nextRaceIndex = i;
                    break;
                }
            }

            mainTracks.forEach((r, i) => {
                // Normalize ID to lowercase and check for alias
                const trackId = (r.id || '').toLowerCase();
                const meta = TRACK_METADATA[trackId] || TRACK_METADATA['baku'] || { gp: r.name || 'Unknown GP', insight: "Global Tour", mapUrl: "" };
                
                const coords = TRACK_COORDINATES[trackId] || TRACK_COORDINATES['baku'] || { top: 50, left: 50 }; 
                
                let dateDisplay = "TBD";
                if(r.date) {
                    const d = new Date(r.date);
                    const month = d.toLocaleString('default', { month: 'short' }).toUpperCase();
                    dateDisplay = `${String(d.getDate()).padStart(2,'0')} ${month}`;
                }

                // DETERMINE SMART POSITIONING CLASSES
                let posClasses = '';
                // If dot is in top 30%, pop DOWN instead of up
                if (coords.top < 30) posClasses += ' pop-down';
                // If dot is far right (> 80%), shift LEFT
                if (coords.left > 80) posClasses += ' shift-left';
                // If dot is far left (< 20%), shift RIGHT
                else if (coords.left < 20) posClasses += ' shift-right';

                // 1. MAP DOTS
                const dot = document.createElement('div');
                dot.className = `location_dot hover-target ${i === nextRaceIndex ? 'active' : ''}`;
                dot.style.top = `${coords.top}%`;
                dot.style.left = `${coords.left}%`;
                dot.setAttribute('data-track-id', r.id); 
                
                // Info Popup with Dynamic Classes
                const info = document.createElement('div');
                info.className = `location_info${posClasses}`;
                info.innerHTML = `
                    <img src="${meta.mapUrl}" alt="Track Map">
                    <div class="li-gp">${meta.gp.replace(' Grand Prix', '').toUpperCase()}</div>
                    <div class="li-date">ROUND ${i+1} // ${dateDisplay}</div>
                    <button class="btn-ai-intel-map hover-target" onclick="fetchTrackIntel('${r.id}')">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> STRATEGY INTEL
                    </button>
                `;
                
                dot.appendChild(info);
                container.appendChild(dot);
                
                // Interaction Logic
                dot.addEventListener('click', (e) => {
                     e.stopPropagation(); 
                     if(e.target.closest('.location_info')) return;

                     const wasActive = dot.classList.contains('active');
                     
                     // Close others
                     document.querySelectorAll('.location_dot').forEach(d => d.classList.remove('active'));
                     document.querySelectorAll('.timeline-card').forEach(c => c.classList.remove('active'));

                     if(!wasActive) {
                         dot.classList.add('active');
                         // Highlight timeline card
                         const tCard = document.querySelector(`.timeline-card[data-track-id="${r.id}"]`);
                         if(tCard) {
                             tCard.classList.add('active');
                             tCard.scrollIntoView({behavior: 'smooth', block: 'nearest', inline: 'center'});
                         }
                     }
                });

                // 2. HORIZONTAL TIMELINE ITEMS
                if(timelineContainer) {
                    const card = document.createElement('div');
                    card.className = `timeline-card hover-target ${i === nextRaceIndex ? 'active' : ''}`;
                    card.setAttribute('data-track-id', r.id);
                    card.innerHTML = `
                        <span class="tl-round">ROUND ${String(i+1).padStart(2,'0')}</span>
                        <span class="tl-gp">${meta.gp.replace(' Grand Prix', '').replace(' GP', '')}</span>
                        <span class="tl-date">${dateDisplay}</span>
                    `;
                    card.onclick = (e) => {
                        e.stopPropagation();
                        // 1. Reset all actives
                        document.querySelectorAll('.timeline-card').forEach(c => c.classList.remove('active'));
                        document.querySelectorAll('.location_dot').forEach(d => d.classList.remove('active'));
                        
                        // 2. Set Active
                        card.classList.add('active');
                        
                        // 3. Activate Dot
                        const targetDot = document.querySelector(`.location_dot[data-track-id="${r.id}"]`);
                        if(targetDot) {
                            targetDot.classList.add('active');
                        }
                    };
                    timelineContainer.appendChild(card);
                }
            });
            
            // Scroll Arrows Logic
            const scrollArea = document.getElementById('timeline-scroll-area');
            const btnPrev = document.getElementById('tl-prev');
            const btnNext = document.getElementById('tl-next');
            
            if(scrollArea && btnPrev && btnNext) {
                // Clear old listeners by cloning (simple way to avoid duplicates if re-rendered)
                const newPrev = btnPrev.cloneNode(true);
                const newNext = btnNext.cloneNode(true);
                btnPrev.parentNode.replaceChild(newPrev, btnPrev);
                btnNext.parentNode.replaceChild(newNext, btnNext);
                
                newPrev.addEventListener('click', () => {
                    scrollArea.scrollBy({ left: -200, behavior: 'smooth' });
                });
                newNext.addEventListener('click', () => {
                    scrollArea.scrollBy({ left: 200, behavior: 'smooth' });
                });
            }
            
            // Global Click to close
            document.addEventListener('click', (e) => {
                if(!e.target.closest('.location_dot') && !e.target.closest('.timeline-card')) {
                    document.querySelectorAll('.location_dot').forEach(d => d.classList.remove('active'));
                    document.querySelectorAll('.timeline-card').forEach(c => c.classList.remove('active'));
                }
            });
        }

        function renderDOTD() {
            const c = document.getElementById('dotd-container');
            if(c) {
                c.innerHTML = DOTD_DATA.map(d => {
                    const tColor = TEAM_COLORS[d.team.toUpperCase().replace(' ', '-').toLowerCase()] || '#fff';
                    return `<div class="dotd-panel" style="background-image: url('${d.image}'); --team-color: ${tColor}">
                        <div class="dotd-label">${d.driver.split(' ')[0]}</div>
                        <div class="dotd-badge-icon"><i class="fa-solid fa-award"></i></div>
                        <div class="dotd-content">
                            <div class="dotd-gp-name">${d.gp}</div>
                            <div class="dotd-driver-name">${d.driver}</div>
                            <div class="dotd-team-name" style="color:${tColor}">${d.team}</div>
                            <div class="mono-font" style="font-size:0.8rem; color:#ccc; margin-top:0.5rem;">${d.desc}</div>
                        </div>
                    </div>`;
                }).join('');
            }
        }

        function renderSeasonAwards() {
            const container = document.getElementById('season-awards-grid');
            if (!container) return;

            // Map the layout classes from your request to the data indices
            const layouts = [
                'archive-card--featured',   // 0: Driver Champ (Big Highlight)
                'archive-card--vertical',   // 1: Driver Season (Tall)
                'archive-card',             // 2: Team Champ
                'archive-card',             // 3: Team Season
                'archive-card--horizontal', // 4: Cleanest (Wide)
                'archive-card--2x',         // 5: Super Sub (Big Square)
                'archive-card',             // 6: Rain Master
                'archive-card--vertical',   // 7: Underdog
                'archive-card',             // 8: Consistent
                'archive-card--horizontal'  // 9: Emerging
            ];

            // Apply the new class name
            container.className = 'grid-container';

            container.innerHTML = SEASON_AWARDS.map((a, index) => {
                const layoutClass = layouts[index] || 'archive-card'; // Default to normal card if data exceeds layout map
                
                return `
                    <div class="archive-card ${layoutClass} hover-target" onclick="openImageModal('${a.img}', '${a.title}', '${a.winner}')">
                        <div class="archive-card__image">
                            <img src="${a.img}" alt="${a.title}">
                        </div>
                        <div class="archive-card__content">
                            <h3>${a.title}</h3>
                            <p>${a.winner}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // --- ANIMATIONS & INIT ---
        function gotoSlide(index) {
            if (isAnimating || index === currentIndex) return;
            isAnimating = true;
            
            const currentSlide = slides[currentIndex];
            const nextSlide = slides[index];
            
            // Update Nav
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const newLink = document.querySelectorAll('.nav-link')[index];
            if(newLink) newLink.classList.add('active');

            // Setup Next Slide (start invisible but in position)
            // autoAlpha handles both opacity and visibility
            gsap.set(nextSlide, { zIndex: 20, autoAlpha: 0, scale: 1.1 }); 
            nextSlide.classList.add('active');

            const tl = gsap.timeline({
                onComplete: () => {
                    // Cleanup Old Slide
                    gsap.set(currentSlide, { zIndex: 1, autoAlpha: 0 });
                    currentSlide.classList.remove('active');
                    
                    // Cleanup New Slide (let CSS take over completely)
                    gsap.set(nextSlide, { clearProps: "all" }); 
                    
                    currentIndex = index;
                    isAnimating = false;
                }
            });
            
            // Animate
            tl.to(currentSlide, { duration: 1, scale: 0.9, autoAlpha: 0, ease: "power3.inOut" }, 0)
              .to(nextSlide, { duration: 1, scale: 1, autoAlpha: 1, ease: "power3.inOut" }, "-=0.8");
            
            // Stagger Elements
            const selector = '.slide-tag, .slide-title, .hero-main-title, .btn-container, .cal-item, .standings-wrapper, .contact-grid, .glass-stat-card, .home-title-group, .home-countdown, .home-card, .next-race-display';
            const elements = nextSlide.querySelectorAll(selector);
            
            if(elements.length) {
                tl.fromTo(elements, { y: 50, autoAlpha: 0 }, { y: 0, autoAlpha: 1, stagger: 0.05, duration: 0.8, ease: "power2.out" }, "-=0.5");
            }
        }

        function updateCountdown() {
            const now = new Date();
            let nextRace = null;
            let nextRaceInfo = null;

            for (const race of mainTracks) {
                if(!race.date) continue;
                const raceDate = new Date(race.date + "T13:00:00");
                if (raceDate > now) {
                    nextRace = raceDate;
                    nextRaceInfo = race;
                    break;
                }
            }

            const infoEl = document.getElementById('next-race-info');

            if (!nextRace) {
                if(infoEl) infoEl.innerText = "SEASON COMPLETED // WAITING FOR SEASON 2";
                return;
            }

            if(infoEl && nextRaceInfo) {
                const meta = TRACK_METADATA[nextRaceInfo.id] || { gp: nextRaceInfo.name };
                const displayName = meta.gp.toUpperCase();
                const day = nextRace.getDate();
                const month = nextRace.toLocaleString('default', { month: 'short' }).toUpperCase();
                infoEl.innerText = `NEXT RACE: ${displayName} // ${day} ${month}`;
            }

            function tick() {
                const current = new Date();
                const diff = nextRace - current;
                if (diff <= 0) return;
                
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const m = Math.floor((diff / 1000 / 60) % 60);
                const s = Math.floor((diff / 1000) % 60);

                const elD = document.getElementById('cd-days');
                const elH = document.getElementById('cd-hours');
                const elM = document.getElementById('cd-mins');
                const elS = document.getElementById('cd-secs');

                if(elD) elD.innerText = String(d).padStart(2, '0');
                if(elH) elH.innerText = String(h).padStart(2, '0');
                if(elM) elM.innerText = String(m).padStart(2, '0');
                if(elS) elS.innerText = String(s).padStart(2, '0');
            }
            setInterval(tick, 1000);
            tick();
        }

        // Check for WebGL support
        function isWebGLAvailable() {
            try {
                const canvas = document.createElement('canvas');
                return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
            } catch (e) {
                return false;
            }
        }

        // --- GLOBAL EVENT LISTENERS ---
        window.onload = () => {
            // Force loader hide after max 3s safety timeout
            setTimeout(() => {
                 if(document.getElementById('loader').style.transform !== 'translateY(-100%)') {
                     gsap.to('#loader', { y: '-100%', duration: 0.8 });
                 }
            }, 3000);

            // Normal Loader Logic
            gsap.to('#load-bar', { width: '100%', duration: 1, onComplete: () => {
                gsap.to('#loader', { y: '-100%', duration: 0.8 });
                
                // --- AUTHENTICATION & DATA LOAD ---
                signInAnonymously(auth)
                    .then(() => {
                        console.log("Signed in anonymously");
                        initAppLogic(); 
                    })
                    .catch((error) => {
                        console.warn("Auth warning, proceeding public access", error);
                        initAppLogic(); 
                    });

                renderDOTD();
                renderSeasonAwards();
                
                // Force Initial Home State
                const homeSlide = slides[0];
                gsap.set(homeSlide, { zIndex: 10, autoAlpha: 1 });
                homeSlide.classList.add('active');
                
                handleHashChange();
            }});
            
            // Cursor Logic
            const cursor = document.getElementById('cursor');
            const follower = document.getElementById('cursor-follower');
            document.addEventListener('mousemove', (e) => {
                if(cursor) { cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px'; }
                if(follower) gsap.to(follower, { x: e.clientX - 20, y: e.clientY - 20, duration: 0.1 });
            });

            // Vanta Background Check with Safe WebGL Init
            if(window.VANTA && isWebGLAvailable()) {
                try {
                    VANTA.NET({
                        el: "#vanta-bg", mouseControls: true, touchControls: true, gyroControls: false,
                        minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00,
                        color: 0x00f0ff, backgroundColor: 0x050505, points: 12.00, maxDistance: 22.00, spacing: 18.00
                    });
                } catch(e) { console.warn("Vanta failed to init:", e); }
            } else {
                 console.warn("WebGL not supported or Vanta missing: Background animation disabled.");
            }
        };

        // Handle Back/Forward Browser Buttons
        window.addEventListener('popstate', handleHashChange);
        
        // Tab Listeners
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const targetTab = e.target.dataset.tab;
                if(!targetTab) return; // ignore season buttons
                
                const parentGroup = e.target.closest('.standings-tabs') || e.target.parentNode;
                if(parentGroup) {
                     parentGroup.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                     e.target.classList.add('active');
                     
                     const wrapper = e.target.closest('.slide-content')?.querySelector('.standings-wrapper');
                     if(wrapper) {
                         wrapper.querySelectorAll('.standings-view').forEach(v => v.classList.remove('active-view'));
                         const targetView = document.getElementById('view-'+targetTab);
                         if(targetView) {
                             targetView.classList.add('active-view');
                             // Trigger animations if needed
                             if(targetTab === 'constructors') {
                                 gsap.fromTo('.constructor-card', {y: 50, opacity: 0}, {y: 0, opacity: 1, stagger: 0.1, duration: 0.5, clearProps: "all"});
                             }
                         }
                     }
                }
            });
        });
    </script>
</body>
</html>
